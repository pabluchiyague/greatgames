{% extends "base.html" %}

{% block title %}Manage Users - GreatGames{% endblock %}

{% block content %}
<div class="home-container">
    <h1 style="margin-bottom: 1.5rem;">Manage Users</h1>

    <form action="{{ url_for('admin.manage_users') }}" method="GET" style="margin-bottom: 1.5rem;">
        <input
            type="text"
            name="q"
            placeholder="Search by username, email, or name..."
            value="{{ query or '' }}"
            style="padding: 0.5rem 0.75rem; border-radius: 4px; border: 1px solid var(--primary-blue); width: 60%; max-width: 400px;"
        >
        <button type="submit" class="btn btn-primary" style="margin-left: 0.5rem;">
            Search
        </button>
        <a href="{{ url_for('admin.manage_users') }}" class="btn btn-secondary" style="margin-left: 0.5rem;">
            Clear
        </a>
    </form>

    <div class="card">
        {% if users %}
        <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
            <thead>
                <tr style="border-bottom: 1px solid var(--primary-blue); text-align: left;">
                    <th style="padding: 0.5rem 0;">Username</th>
                    <th style="padding: 0.5rem 0;">Email</th>
                    <th style="padding: 0.5rem 0;">Name</th>
                    <th style="padding: 0.5rem 0;">Role</th>
                    <th style="padding: 0.5rem 0;">Joined</th>
                    <th style="padding: 0.5rem 0;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr style="border-bottom: 1px solid var(--primary-blue);">
                    <td style="padding: 0.4rem 0;">
                        <a href="{{ url_for('users.profile', username=user.username) }}"
                           style="color: var(--accent-color); font-weight: bold;">
                            {{ user.username }}
                        </a>
                    </td>
                    <td style="padding: 0.4rem 0; color: var(--secondary-blue);">
                        {{ user.email }}
                    </td>
                    <td style="padding: 0.4rem 0; color: var(--secondary-blue);">
                        {{ user.name or '—' }}
                    </td>
                    <td style="padding: 0.4rem 0;">
                        {% if user.is_admin %}
                            <span style="font-size: 0.8rem; background: #415A77; padding: 2px 6px; border-radius: 3px;">
                                Admin
                            </span>
                        {% else %}
                            <span style="font-size: 0.8rem; background: #1B263B; padding: 2px 6px; border-radius: 3px;">
                                User
                            </span>
                        {% endif %}
                    </td>
                    <td style="padding: 0.4rem 0; color: var(--secondary-blue); white-space: nowrap;">
                        {{ user.created_at }}
                    </td>
                    <td style="padding: 0.4rem 0;">
                        {% if user.id != session.user_id %}
                        <form action="{{ url_for('admin.toggle_admin', user_id=user.id) }}"
                              method="POST"
                              style="display:inline;">
                            <button type="submit" class="btn btn-secondary" style="margin-right: 0.25rem;">
                                {% if user.is_admin %}Remove admin{% else %}Make admin{% endif %}
                            </button>
                        </form>

                        <form action="{{ url_for('admin.delete_user', user_id=user.id) }}"
                              method="POST"
                              style="display:inline;"
                              onsubmit="return confirm('Delete this user and their data? This cannot be undone.');">
                            <button type="submit" class="btn btn-danger">
                                Delete
                            </button>
                        </form>
                        {% else %}
                        <span style="font-size: 0.8rem; color: var(--secondary-blue);">
                            (This is you)
                        </span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p style="color: var(--secondary-blue);">
            No users found.
        </p>
        {% endif %}
    </div>

    <div style="margin-top: 1.5rem;">
        <a href="{{ url_for('admin.dashboard') }}" style="color: var(--accent-color);">
            ← Back to admin dashboard
        </a>
    </div>
</div>
{% endblock %}
