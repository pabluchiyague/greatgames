{% extends "base.html" %}

{% block title %}Home - GreatGames{% endblock %}

{% block content %}
<div class="home-container">
    <h1 style="margin-bottom: 2rem;">Welcome back, {{ session.username }}!</h1>
    
    <!-- Your Recent Activity -->
	<div class="card">
		<h2>Your Recent Activity</h2>

		{% if recent_activity %}
		<div class="game-grid" style="margin-top: 1rem;">
			{% for activity in recent_activity %}
			<a href="{{ url_for('games.game_detail', game_id=activity.game_id) }}" class="game-card">

				<div class="game-card-cover">
					<img src="{{ activity.cover_image_url or url_for('static', filename='images/default_cover.jpg') }}"
						 alt="{{ activity.title }}">
				</div>

				<div class="game-card-info">
					<h3 class="game-card-title">{{ activity.title }}</h3>
					<p class="game-card-meta">{{ activity.description }}</p>
				</div>

			</a>
			{% endfor %}
		</div>
		{% else %}
		<p style="color: var(--secondary-blue); margin-top: 1rem;">
			You haven't added any games yet. <a href="{{ url_for('games.browse') }}" style="color: var(--accent-color);">Start browsing!</a>
		</p>
		{% endif %}
	</div>

    
    <!-- Recommendations -->
    {% if recommendations %}
    <div class="card">
        <h2>Recommended For You</h2>
        <p style="color: var(--secondary-blue); margin-bottom: 1rem;">Based on games you've completed</p>
        <div class="grid grid-3" style="margin-top: 1rem;">
            {% for game in recommendations %}
            <a href="{{ url_for('games.game_detail', game_id=game.id) }}" style="text-decoration: none; color: inherit;">
                <div class="game-card">
                    {% if game.cover_image_url %}
                    <img src="{{ game.cover_image_url }}" alt="{{ game.title }}">
                    {% else %}
                    <div style="width: 100%; height: 300px; background-color: var(--primary-blue); display: flex; align-items: center; justify-content: center; border-radius: 5px;">
                        <span style="font-size: 3rem;">üéÆ</span>
                    </div>
                    {% endif %}
                    
                    <div class="game-card-info">
                        <h3 class="game-card-title">{{ game.title }}</h3>
                        <p class="game-card-meta">{{ game.genre }}</p>
                        <span style="color: #ffd700;">‚≠ê {{ "%.1f"|format(game.average_rating) }}</span>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
	    <!-- Friends Activity -->
		{% if following_activity %}
		<div class="card">
			<h2>Friend Activity</h2>

			<div class="activity-carousel">
				<button class="carousel-btn carousel-prev" type="button">‚Äπ</button>

				<div class="activity-slides">
					{# group into slides of 4 #}
					{% for activity in following_activity %}
						{% if loop.index0 % 6 == 0 %}
						<div class="activity-slide {% if loop.index0 == 0 %}is-active{% endif %}">
						{% endif %}

							<div class="activity-card">
								<div class="activity-card-image">
									{% if activity.cover_image_url %}
									<img src="{{ activity.cover_image_url }}"
										 alt="{{ activity.title }}">
									{% else %}
									<div class="no-cover">üéÆ</div>
									{% endif %}
								</div>
								<div class="activity-card-body">
									<a href="{{ url_for('users.profile', username=activity.username) }}"
									   class="activity-user">
										{{ activity.username }}
									</a>
									<div class="activity-text">
										{{ activity.description }}
										{% if activity.game_id %}
										<a href="{{ url_for('games.game_detail', game_id=activity.game_id) }}">
											{{ activity.title }}
										</a>
										{% endif %}
									</div>
									<div class="activity-time">
										{{ activity.created_at }}
									</div>
								</div>
							</div>

						{% if loop.index0 % 6 == 5 or loop.last %}
						</div>
						{% endif %}
					{% endfor %}
				</div>

				<button class="carousel-btn carousel-next" type="button">‚Ä∫</button>
			</div>
		</div>
		{% else %}
		<div class="card">
			<h2>Friend Activity</h2>
			<p style="color: var(--secondary-blue); margin-top: 1rem;">
				Follow other users to see their activity here. <a href="{{ url_for('users.discover_friends') }}" style="color: var(--accent-color);">Find users to follow!</a>
			</p>
		</div>
		{% endif %}

    </div>
{% endblock %}